<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dutch Auction (Descending-Price) Simulator</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 1000px; margin: 30px auto; background: #f8f9fa; }
  h1 { text-align: center; color: #2c3e50; }
  .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.12); }
  .bidders { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
  .bidder { text-align: center; padding: 20px; border-radius: 12px; background: #e9f7ef; border: 3px solid #28a745; transition: all 0.3s; }
  .bidder.waiting { background: #f8f9d1; border-color: #ffc107; }
  .bidder.winner { background: #d4edda; border-color: #28a745; transform: scale(1.1); box-shadow: 0 0 20px rgba(40,167,69,0.5); }
  .bidder h3 { margin: 0 0 12px; font-size: 1.4em; }
  .valuation { font-size: 1.3em; font-weight: bold; color: #495057; }
  button.claim { 
    margin-top: 15px; padding: 14px 28px; font-size: 20px; font-weight: bold;
    background: #28a745; color: white; border: none; border-radius: 50px; cursor: pointer;
    transition: all 0.2s;
  }
  button.claim:hover { background: #218838; transform: scale(1.05); }
  button.claim:disabled { background: #6c757d; cursor: not-allowed; transform: none; }

  .clock {
    text-align: center; margin: 30px 0; padding: 30px; background: #343a40; color: white; border-radius: 15px;
  }
  .current-price { font-size: 72px; font-weight: bold; letter-spacing: 2px; }
  .controls { text-align: center; margin: 30px 0; }
  button.main { padding: 14px 32px; font-size: 20px; margin: 0 10px; border: none; border-radius: 8px; cursor: pointer; }
  #startBtn { background: #007bff; color: white; }
  #resetBtn { background: #6c757d; color: white; }
  .status { text-align: center; font-size: 24px; margin: 20px 0; }
  .winner-box { background: #d4edda; padding: 20px; border-radius: 10px; font-size: 28px; color: #155724; text-align: center; }
</style>
</head>
<body>

<div class="container">
  <h1>Dutch Auction Simulator<br><small>Descending-Price Open Auction (like flower auctions in Holland)</small></h1>

  <p style="text-align:center; font-size:18px;">
    The price starts high and falls rapidly.<br>
    The first bidder to click <strong>“I TAKE IT!”</strong> wins the item and pays the current price.
  </p>

  <div class="clock">
    <div>Current Price</div>
    <div class="current-price" id="price">$200.00</div>
  </div>

  <div class="status" id="status">Click <strong>Start Auction</strong> to begin the descending clock!</div>

  <div class="controls">
    <button id="startBtn" class="main" onclick="startAuction()">Start Auction</button>
    <button id="resetBtn" class="main" onclick="resetAuction()">Reset</button>
  </div>

  <div class="bidders" id="biddersContainer">
    <!-- Generated by JavaScript -->
  </div>

  <div id="result" class="winner-box" style="display:none;"></div>
</div>

<script>
const bidderNames = ["Alice", "Bob", "Charlie", "Diana", "Eve", "Frank"];
let bidders = [];
let currentPrice = 200;
let timer = null;
let auctionActive = false;

function initBidders() {
  bidders = bidderNames.map(name => ({
    name,
    valuation: Math.round((Math.random() * 130 + 70) * 100) / 100, // random $70–$200
    hasClaimed: false
  }));

  const container = document.getElementById("biddersContainer");
  container.innerHTML = "";

  bidders.forEach((b, i) => {
    const div = document.createElement("div");
    div.className = "bidder waiting";
    div.id = "bidder" + i;
    div.innerHTML = `
      <h3>${b.name}</h3>
      <div class="valuation">Valuation: $${b.valuation.toFixed(2)}</div>
      <button class="claim" id="btn${i}" onclick="claim(${i})" disabled>I TAKE IT!</button>
    `;
    container.appendChild(div);
  });
}

function startAuction() {
  if (auctionActive) return;
  auctionActive = true;
  document.getElementById("startBtn").disabled = true;
  document.getElementById("status").textContent = "Price is falling… Who will claim first?";

  // Enable all buttons
  bidders.forEach((_, i) => {
    document.getElementById("btn" + i).disabled = false;
    document.getElementById("bidder" + i).classList.remove("waiting");
  });

  currentPrice = 200;
  updatePriceDisplay();

  // Start descending clock
  timer = setInterval(() => {
    currentPrice -= 0.75;  // speed of descent
    if (currentPrice < 0) currentPrice = 0;
    updatePriceDisplay();

    // Auto-highlight bidders whose valuation is now above price
    bidders.forEach((b, i) => {
      const el = document.getElementById("bidder" + i);
      if (b.valuation >= currentPrice && !b.hasClaimed) {
        el.style.background = "#fff3cd";
        el.style.borderColor = "#ffc107";
      }
    });

    if (currentPrice <= 0) endAuctionNoWinner();
  }, 50); // very smooth (20 drops per second)
}

function claim(index) {
  if (!auctionActive) return;
  clearInterval(timer);
  auctionActive = false;

  const winner = bidders[index];
  winner.hasClaimed = true;

  // Visual feedback
  document.getElementById("bidder" + index).classList.add("winner");
  bidders.forEach((_, i) => {
    document.getElementById("btn" + i).disabled = true;
  });

  // Show result
  document.getElementById("status").style.display = "none";
  document.getElementById("result").style.display = "block";
  document.getElementById("result").innerHTML = `
    <div>Winner: <strong>${winner.name}</strong> claims the item!</div>
    <div>Winning price: <strong>$${currentPrice.toFixed(2)}</strong></div>
    <div>Private valuation was $${winner.valuation.toFixed(2)} → 
        Surplus: <strong>$${(winner.valuation - currentPrice).toFixed(2)}</strong></div>
    <div>Seller revenue: <strong>$${currentPrice.toFixed(2)}</strong></div>
  `;
}

function endAuctionNoWinner() {
  clearInterval(timer);
  auctionActive = false;
  document.getElementById("status").textContent = "Price reached $0 — No one bought the item!";
  document.getElementById("result").style.display = "block";
  document.getElementById("result").innerHTML = "<strong>No winner</strong> — the item remains unsold.";
}

function updatePriceDisplay() {
  document.getElementById("price").textContent = "$" + currentPrice.toFixed(2);
}

function resetAuction() {
  clearInterval(timer);
  auctionActive = false;
  document.getElementById("startBtn").disabled = false;
  document.getElementById("status").style.display = "block";
  document.getElementById("status").textContent = "Click <strong>Start Auction</strong> to begin the descending clock!";
  document.getElementById("result").style.display = "none";
  initBidders();
}

// Initialize
initBidders();
</script>

<footer style="text-align:center; margin-top:60px; color:#666; font-size:0.9em;">
  Dutch Auction Simulator • Equivalent to First-Price Sealed-Bid in theory (revenue equivalence)
</footer>

</body>
</html>